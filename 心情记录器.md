# 心情记录器 WriteUp
对前端这块，Node.js之类的知识比较熟而且感兴趣的我一开始就很想尝试这一题。
先是通过拿下附加，安装依赖，然后本地跑起来了，发现有home，login之类的路由。一开始不太熟悉到底要拿哪里的flag，附件的源码我自以为研究够了，但是感觉没有哪里可以推进，中间尝试了很多前端方面的方法，没啥结果，就先搁置了。
中间做其他题也经常返回来尝试，还是没什么进展。
直到看到群里的hint，原型链污染这块的，我就突然想起去年和张芊学长交流了js对象这块通过改toString(),length之类的绕过一些检测的方法。于是我就在这题也改了相关的方法，发现其实并没有太大作用，由于也是第一个从服务器自己拿flag的题目，不太懂我应该做什么来拿到flag。发现污染来污染去，传过去的始终是一个字符串，缺少转换为函数执行的这部分，搜索也发现其他的类似题也是污染完有一个执行的过程，意识到自己应该是没找到任意执行代码的漏洞，尝试了各种方法（主要从JSON.stringify这方面入手的）也没能任意执行代码。然后就尝试找群里管理学长学姐交流一下，得到了重要hint（这个其实已经放在了CTF网上，交流之后突然意识到了提ejs的作用）：ejs原型链污染rce，于是搜索学习发现原来要用ejs的漏洞来执行污染过的代码。
本地改改删删模拟，最后又发现个问题，就是如果keyd的参数是Object，挺顺利的污染并且执行，但是题目是Function，而最后触发bug的是Object，并没污染成功，于是想ejs这个bug由function触发，构造了user之类的，发现还是不太行。凭借js知识发现少了一层，还得污染父级，于是再套一个__proto__就ok了。
这里解决了在服务器执行任意代码的部分，但是发现我看不到结果，这里就非常疑惑了，难道要通过网络请求，接口之类的方法得到数据？
于是和学长交流了一下，如醍醐灌顶，学到了shell反射的相关知识，可惜我的服务器过期了，现在买的是静态网站服务器，不太能当vps。于是我临时搞了个免费一个月的服务器，搭建好环境，并且和本机Windows调试好了，可以实现反射shell功能，然后就成功了！拿到了服务器上的flag！
经过了这题我学到了超多知识，更重要的是知道了flag在哪，要怎么拿，主要要解决的问题之类的基本流程。